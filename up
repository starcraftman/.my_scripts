#!/usr/bin/env bash
REPOS=( ~/.shell/.[^.]* ~/.shell/..?* ~/.my_scripts )
SYS=generic
if hash apt-get 2>/dev/null; then
    SYS=debian
fi

# Update repositories passed as arguments
update_repos()
{
echo 'updating repos'
pushd .

local BGreen='\e[1;32m'
local NC="\e[m"
for dir ; do
    if [ -d "$dir" ]; then
	cd "$dir"
	echo -e " >>> ${BGreen}$dir${NC} <<< "
	if [ -d ".git" ]; then
            git pull
	elif [ -d ".hg" ]; then
            hg pull
	fi
    fi
done

popd
}

if [ "xdebian" == "x$SYS" ]; then
    echo 'updating debian platform'
    sudo apt-get update && sudo apt-get -y dist-upgrade
    sudo apt-get autoremove
    sudo apt-get -f install
fi

if [ -d ~/.vim/bundle/Vundle.vim ]; then
    echo 'Updating vim plugins.'
    vim +PluginUpdate +qa
fi

update_repos "${REPOS[@]}"

# Force ag/ack update
if [ "xdebian" == "x$SYS" ] && [ -f $OPTDIR/src/ack/README.md ]; then
    echo 'updating programs built from source'
    \rm -R -f $OPTDIR
    SysInstall.py src > /dev/null 2>&1
fi

echo 'done'
